{% extends 'base.html' %}

{% block title %}لوحة تحكم الختمات{% endblock %}

{% block extra_css %}
<style>
    .dashboard-header {
        background: linear-gradient(135deg, #5D4037 0%, #8D6E63 100%);
        color: white;
        padding: 2rem;
        border-radius: 10px;
        margin-bottom: 2rem;
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    .dashboard-card {
        background-color: white;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        height: 100%;
        transition: all 0.3s ease;
    }
    .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0,0,0,0.15);
    }
    .stat-card {
        text-align: center;
        padding: 1.5rem;
        border-radius: 10px;
        color: white;
        margin-bottom: 1.5rem;
    }
    .stat-card.primary {
        background: linear-gradient(135deg, #5D4037 0%, #8D6E63 100%);
    }
    .stat-card.success {
        background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
    }
    .stat-card.info {
        background: linear-gradient(135deg, #2196F3 0%, #03A9F4 100%);
    }
    .stat-card.warning {
        background: linear-gradient(135deg, #FF9800 0%, #FFC107 100%);
    }
    .stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    .stat-label {
        font-size: 1rem;
        opacity: 0.9;
    }
    .progress-circle {
        position: relative;
        width: 120px;
        height: 120px;
        margin: 0 auto 1rem;
    }
    .progress-circle svg {
        width: 100%;
        height: 100%;
    }
    .progress-circle .progress-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 1.5rem;
        font-weight: 700;
    }
    .khatma-card {
        border-right: 4px solid #5D4037;
        transition: all 0.3s ease;
    }
    .khatma-card:hover {
        border-right-color: #2196F3;
    }
    .khatma-card.completed {
        border-right-color: #4CAF50;
    }
    .khatma-title {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }
    .khatma-meta {
        color: #757575;
        font-size: 0.9rem;
        margin-bottom: 0.75rem;
    }
    .khatma-progress {
        height: 8px;
        border-radius: 4px;
    }
    .activity-item {
        padding: 0.75rem 0;
        border-bottom: 1px solid #f0f0f0;
    }
    .activity-item:last-child {
        border-bottom: none;
    }
    .activity-time {
        color: #757575;
        font-size: 0.8rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-4">
    {% if error_message %}
    <div class="alert alert-danger">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        {{ error_message }}
    </div>
    {% endif %}

    <div class="dashboard-header text-center">
        <h1 class="display-4">لوحة تحكم الختمات</h1>
        <p class="lead">متابعة تقدم الختمات وإدارتها</p>
        <a href="{% url 'core:create_khatma' %}" class="btn btn-light mt-3">
            <i class="fas fa-plus-circle"></i> إنشاء ختمة جديدة
        </a>
    </div>

    <!-- Statistics Row -->
    <div class="row">
        <div class="col-md-3 col-sm-6">
            <div class="stat-card primary">
                <div class="stat-number">{{ total_khatmas }}</div>
                <div class="stat-label">إجمالي الختمات</div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="stat-card success">
                <div class="stat-number">{{ completed_khatmas }}</div>
                <div class="stat-label">الختمات المكتملة</div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="stat-card info">
                <div class="stat-number">{{ completed_parts }}</div>
                <div class="stat-label">الأجزاء المقروءة</div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="stat-card warning">
                <div class="progress-circle">
                    <svg viewBox="0 0 36 36">
                        <path class="circle-bg"
                            d="M18 2.0845
                            a 15.9155 15.9155 0 0 1 0 31.831
                            a 15.9155 15.9155 0 0 1 0 -31.831"
                            fill="none"
                            stroke="rgba(255,255,255,0.2)"
                            stroke-width="3" />
                        <path class="circle"
                            d="M18 2.0845
                            a 15.9155 15.9155 0 0 1 0 31.831
                            a 15.9155 15.9155 0 0 1 0 -31.831"
                            fill="none"
                            stroke="#fff"
                            stroke-width="3"
                            stroke-dasharray="{{ overall_progress }}, 100" />
                    </svg>
                    <div class="progress-text">{{ overall_progress|floatformat:0 }}%</div>
                </div>
                <div class="stat-label">التقدم الإجمالي</div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <!-- My Khatmas -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>ختماتي</h3>
                    <span class="badge bg-primary">{{ created_khatmas.count }}</span>
                </div>
                <hr>
                {% if created_khatmas %}
                    <div class="khatma-list">
                        {% for khatma in created_khatmas %}
                            <div class="khatma-card p-3 mb-3 {% if khatma.is_completed %}completed{% endif %}">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h4 class="khatma-title">{{ khatma.title }}</h4>
                                    <span class="badge {% if khatma.is_completed %}bg-success{% else %}bg-primary{% endif %}">
                                        {% if khatma.is_completed %}مكتملة{% else %}جارية{% endif %}
                                    </span>
                                </div>
                                <div class="khatma-meta">
                                    <i class="bi bi-calendar3"></i> {{ khatma.created_at|date:"Y-m-d" }}
                                    {% if khatma.khatma_type %}
                                        <span class="mx-2">•</span>
                                        <i class="bi bi-tag"></i> {{ khatma.get_khatma_type_display }}
                                    {% endif %}
                                </div>
                                <div class="progress khatma-progress mb-2">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: {{ khatma.get_progress_percentage }}%"></div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small>{{ khatma.get_progress_percentage }}% مكتمل</small>
                                    <a href="{% url 'core:khatma_detail' khatma.id %}" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye"></i> عرض
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-journal-plus" style="font-size: 3rem; color: #ccc;"></i>
                        <p class="mt-3">لم تقم بإنشاء أي ختمات بعد</p>
                        <a href="{% url 'core:create_khatma' %}" class="btn btn-primary mt-2">
                            <i class="bi bi-plus-circle"></i> إنشاء ختمة جديدة
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Participating Khatmas -->
        <div class="col-md-6">
            <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>مشاركاتي</h3>
                    <span class="badge bg-info">{{ participating_khatmas.count }}</span>
                </div>
                <hr>
                {% if participating_khatmas %}
                    <div class="khatma-list">
                        {% for khatma in participating_khatmas %}
                            <div class="khatma-card p-3 mb-3 {% if khatma.is_completed %}completed{% endif %}">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h4 class="khatma-title">{{ khatma.title }}</h4>
                                    <span class="badge {% if khatma.is_completed %}bg-success{% else %}bg-info{% endif %}">
                                        {% if khatma.is_completed %}مكتملة{% else %}جارية{% endif %}
                                    </span>
                                </div>
                                <div class="khatma-meta">
                                    <i class="bi bi-person-circle"></i> {{ khatma.creator.username }}
                                    <span class="mx-2">•</span>
                                    <i class="bi bi-calendar3"></i> {{ khatma.created_at|date:"Y-m-d" }}
                                </div>
                                <div class="progress khatma-progress mb-2">
                                    <div class="progress-bar bg-info" role="progressbar" style="width: {{ khatma.get_progress_percentage }}%"></div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small>{{ khatma.get_progress_percentage }}% مكتمل</small>
                                    <a href="{% url 'core:khatma_detail' khatma.id %}" class="btn btn-sm btn-outline-info">
                                        <i class="bi bi-eye"></i> عرض
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-people" style="font-size: 3rem; color: #ccc;"></i>
                        <p class="mt-3">أنت لا تشارك في أي ختمات حالياً</p>
                        <a href="{% url 'core:community_khatmas' %}" class="btn btn-info mt-2">
                            <i class="bi bi-search"></i> استكشف الختمات المتاحة
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
